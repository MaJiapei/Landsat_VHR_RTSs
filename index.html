<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RTS Analysis System</title>
    <!-- OpenLayers CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v8.2.0/ol.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <script src="https://unpkg.com/vue@3.3.4/dist/vue.global.js"></script>
    <script src="https://unpkg.com/vue-router@4.2.4/dist/vue-router.global.js"></script>
</head>
<body>
    <div id="app">
        <div class="main-layout">
            <div class="map-container">
                <div id="map"></div>
                <!-- ä½ç½®æœç´¢æ¡† -->
                <div class="location-search-box" id="locationSearchBox">
                    <input 
                        type="text" 
                        v-model="searchCoordinates" 
                        placeholder="Longitude, Latitude (e.g., 92.7459, 35.0762)"
                        class="search-input"
                        @keyup.enter="searchLocation"
                    />
                    <button @click="searchLocation" class="search-btn" title="Search">
                        <i class="fas fa-location-arrow"></i>
                    </button>
                </div>
                <!-- æµ‹é‡å·¥å…· -->
                <div class="measure-tools">
                    <button @click="toggleMeasure('distance')" class="measure-btn" :class="{ active: measureType === 'distance' }" title="Measure Distance">
                        <i class="fas fa-ruler"></i>
                    </button>
                    <button @click="toggleMeasure('area')" class="measure-btn" :class="{ active: measureType === 'area' }" title="Measure Area">
                        <i class="fas fa-draw-polygon"></i>
                    </button>
                </div>
                <div v-if="currentRoute === '/route3'" class="map-tools">
                    <button @click="startScreenshot" class="tool-btn" :class="{ active: isScreenshotMode }">
                        <span class="icon">ðŸ“·</span>
                        Screenshot
                    </button>
                </div>
                <!-- åœ°å›¾åŠ è½½æç¤ºï¼ˆç”¨äºŽ route2 æ—¶é—´åºåˆ—åˆ†æžï¼‰ -->
                <div v-if="timeseriesLoading && currentRoute === '/route2'" class="map-loading-overlay">
                    <div class="map-loading-content">
                        <div class="map-loading-spinner"></div>
                        <p>Processing...</p>
                    </div>
                </div>
            </div>
            <div class="gutter" v-show="isPanelFixed"></div>
            <div 
                class="right-panel" 
                :class="{ 'panel-hidden': !isPanelVisible, 'panel-fixed': isPanelFixed }"
                @mouseenter="handlePanelMouseEnter"
                @mouseleave="handlePanelMouseLeave"
            >
                <div class="panel-header">
                    <div class="route-tabs">
                        <a href="javascript:void(0)" 
                           class="route-tab" 
                           :class="{ 'router-link-active': currentRoute === '/route2' && isPanelFixed }"
                           @click="activateRoute('/route2')">
                            Timeseries Analysis
                        </a>
                        <a href="javascript:void(0)" 
                           class="route-tab" 
                           :class="{ 'router-link-active': currentRoute === '/route3' && isPanelFixed }"
                           @click="activateRoute('/route3')">
                            Yolo Object Detection
                        </a>
                    </div>
                    <button 
                        v-if="isPanelFixed" 
                        class="panel-close-btn" 
                        @click="closePanel"
                        title="Close panel">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="content-panel" v-if="isPanelFixed">
                    <router-view v-slot="{ Component }">
                        <component :is="Component" />
                    </router-view>
                </div>
                <div class="content-panel content-panel-hint" v-else>
                    <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #666; text-align: center; padding: 20px;">
                        <div>
                            <i class="fas fa-hand-pointer" style="font-size: 48px; margin-bottom: 16px; color: #999;"></i>
                            <p style="font-size: 16px; margin: 0;">Click a tab above to start analysis</p>
                        </div>
                    </div>
                </div>
            </div>
            <!-- å³ä¾§è¾¹ç¼˜è§¦å‘åŒº -->
            <div 
                class="panel-trigger" 
                v-show="!isPanelFixed"
                @mouseenter="showPanel"
            ></div>
        </div>
    </div>

    <!-- OpenLayers JS -->
    <script src="https://cdn.jsdelivr.net/npm/ol@v8.2.0/dist/ol.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <!-- GeoJSON æ•°æ® -->
    <script src="layers/PredictedRTS.js"></script>
    <script src="layers/XiadataRTS.js"></script>
    <script>
        // å…¨å±€äº‹ä»¶æ€»çº¿
        window.eventBus = {
            events: {},
            
            on(eventName, fn) {
                this.events[eventName] = this.events[eventName] || [];
                this.events[eventName].push(fn);
            },
            
            off(eventName, fn) {
                if (this.events[eventName]) {
                    if (fn) {
                        this.events[eventName] = this.events[eventName].filter(f => f !== fn);
                    } else {
                        delete this.events[eventName];
                    }
                }
            },
            
            emit(eventName, data) {
                if (this.events[eventName]) {
                    this.events[eventName].forEach(fn => fn(data));
                }
            }
        };
    </script>
    <script src="app.js"></script>
</body>
</html>

